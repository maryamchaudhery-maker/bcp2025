<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Council Election Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #333;
        }
        
        .container {
            width: 100%;
            max-width: 1100px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .card {
            background: #f9f9f9;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        h2 {
            color: #283593;
            margin-bottom: 20px;
            text-align: center;
        }
        
        h3 {
            color: #283593;
            margin-bottom: 15px;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 2px solid #ddd;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        input[type="text"], input[type="password"], textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus, input[type="password"]:focus, textarea:focus {
            border-color: #3949ab;
            outline: none;
        }
        
        button {
            background: #3949ab;
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #283593;
        }
        
        .btn-secondary {
            background: #f5f5f5;
            color: #333;
            border: 1px solid #ddd;
        }
        
        .btn-secondary:hover {
            background: #e0e0e0;
        }
        
        .error {
            color: #d32f2f;
            margin-top: 10px;
            text-align: center;
            font-weight: 500;
        }
        
        .success {
            color: #388e3c;
            margin-top: 10px;
            text-align: center;
            font-weight: 500;
        }
        
        .categories-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
            margin-top: 20px;
        }
        
        .category {
            border: 2px solid #ddd;
            border-radius: 12px;
            padding: 20px;
            background: white;
        }
        
        .symbols-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 15px;
        }
        
        .symbol {
            border: 2px solid #ddd;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .symbol:hover {
            border-color: #3949ab;
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .symbol.selected {
            border-color: #3949ab;
            background-color: #e8eaf6;
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .symbol i {
            font-size: 40px;
            margin-bottom: 15px;
            color: #3949ab;
        }
        
        .symbol-name {
            font-weight: 600;
            font-size: 18px;
        }
        
        .results {
            display: none;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background: white;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }
        
        .result-symbol {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .result-symbol i {
            font-size: 24px;
            color: #3949ab;
        }
        
        .progress-bar {
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
            width: 200px;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(90deg, #3949ab 0%, #283593 100%);
            border-radius: 10px;
        }
        
        .view-toggle {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .view-toggle button {
            width: auto;
            margin: 0;
            padding: 10px 20px;
            background: #e0e0e0;
            color: #666;
        }
        
        .view-toggle button.active {
            background: #3949ab;
            color: white;
        }
        
        .admin-panel {
            display: none;
            margin-top: 30px;
            border-top: 2px solid #eee;
            padding-top: 20px;
        }
        
        .admin-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .admin-buttons button {
            width: auto;
            padding: 12px 25px;
        }
        
        .export-btn {
            background: #388e3c !important;
        }
        
        .export-btn:hover {
            background: #2e7d32 !important;
        }
        
        .reset-btn {
            background: #d32f2f !important;
        }
        
        .reset-btn:hover {
            background: #c62828 !important;
        }
        
        .student-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .student-item {
            padding: 8px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
        }
        
        .student-item:last-child {
            border-bottom: none;
        }
        
        .voted {
            color: #388e3c;
            font-weight: 600;
        }
        
        .not-voted {
            color: #d32f2f;
        }
        
        .instructions {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid #ddd;
        }
        
        .instructions h4 {
            color: #283593;
            margin-bottom: 10px;
        }
        
        .instructions ul {
            padding-left: 20px;
            margin-bottom: 10px;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #777;
            border-top: 1px solid #eee;
        }
        
        @media (max-width: 768px) {
            .symbols-container {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .admin-buttons {
                flex-direction: column;
            }
            
            .view-toggle {
                flex-direction: column;
            }
            
            .view-toggle button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Student Council Election Portal</h1>
            <p class="subtitle">Cast your vote for your preferred symbols in each category</p>
        </header>
        
        <div class="content">
            <!-- Admin Setup Section -->
            <div class="card admin-setup-section">
                <h2>Admin Election Setup</h2>
                <div class="form-group">
                    <label for="adminPassword">Admin Password</label>
                    <input type="password" id="adminPassword" placeholder="Enter admin password">
                </div>
                
                <div class="form-group">
                    <label for="studentIds">Student IDs (one per line)</label>
                    <textarea id="studentIds" rows="6" placeholder="STU001&#10;STU002&#10;STU003&#10;..."></textarea>
                </div>
                
                <button id="adminSetupBtn">Setup Election</button>
                <p class="error" id="adminError"></p>
                <p class="success" id="adminSuccess"></p>
                
                <div class="instructions">
                    <h4>Instructions for Admin:</h4>
                    <ul>
                        <li>Enter the admin password (default: admin123)</li>
                        <li>Enter all student IDs, one per line</li>
                        <li>Click "Setup Election" to initialize the voting system</li>
                        <li>Share the voting URL with students: <span id="voteUrl"></span></li>
                    </ul>
                </div>
            </div>
            
            <!-- Login Section -->
            <div class="card login-section" style="display: none;">
                <h2>Student Login</h2>
                <div class="form-group">
                    <label for="studentId">Student ID</label>
                    <input type="text" id="studentId" placeholder="Enter your assigned student ID">
                </div>
                <button id="loginBtn">Login to Vote</button>
                <p class="error" id="loginError"></p>
            </div>
            
            <!-- Voting Section -->
            <div class="card voting-section" style="display: none;">
                <h2>Cast Your Vote</h2>
                <p style="text-align: center; margin-bottom: 20px;">Select one symbol from each category:</p>
                
                <div class="categories-container">
                    <!-- Head Boy Category -->
                    <div class="category">
                        <h3>Head Boy</h3>
                        <div class="symbols-container">
                            <div class="symbol" data-category="headBoy" data-symbol="jeep">
                                <i class="fas fa-truck"></i>
                                <div class="symbol-name">Jeep</div>
                            </div>
                            <div class="symbol" data-category="headBoy" data-symbol="eagle">
                                <i class="fas fa-eagle"></i>
                                <div class="symbol-name">Eagle</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Deputy Head Boy Category -->
                    <div class="category">
                        <h3>Deputy Head Boy</h3>
                        <div class="symbols-container">
                            <div class="symbol" data-category="deputyHeadBoy" data-symbol="wolf">
                                <i class="fas fa-paw"></i>
                                <div class="symbol-name">Wolf</div>
                            </div>
                            <div class="symbol" data-category="deputyHeadBoy" data-symbol="horse">
                                <i class="fas fa-horse"></i>
                                <div class="symbol-name">Horse</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Head Girl Category -->
                    <div class="category">
                        <h3>Head Girl</h3>
                        <div class="symbols-container">
                            <div class="symbol" data-category="headGirl" data-symbol="cookie">
                                <i class="fas fa-cookie"></i>
                                <div class="symbol-name">Cookie</div>
                            </div>
                            <div class="symbol" data-category="headGirl" data-symbol="basketball">
                                <i class="fas fa-basketball-ball"></i>
                                <div class="symbol-name">Basketball</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Deputy Head Girl Category -->
                    <div class="category">
                        <h3>Deputy Head Girl</h3>
                        <div class="symbols-container">
                            <div class="symbol" data-category="deputyHeadGirl" data-symbol="butterfly">
                                <i class="fas fa-butterfly"></i>
                                <div class="symbol-name">Butterfly</div>
                            </div>
                            <div class="symbol" data-category="deputyHeadGirl" data-symbol="eagle">
                                <i class="fas fa-eagle"></i>
                                <div class="symbol-name">Eagle</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button id="castVoteBtn" style="margin-top: 25px;">Cast Vote</button>
                <button id="logoutBtn" class="btn-secondary" style="margin-top: 10px;">Logout</button>
                <p class="error" id="voteError"></p>
                <p class="success" id="voteSuccess"></p>
            </div>
            
            <!-- Results Section -->
            <div class="card results">
                <h2>Election Results</h2>
                <p style="text-align: center; margin-bottom: 20px;">Current voting results:</p>
                
                <h3>Head Boy</h3>
                <div class="result-item">
                    <div class="result-symbol">
                        <i class="fas fa-truck"></i>
                        <span>Jeep</span>
                    </div>
                    <div class="result-count">
                        <span id="jeepCount">0</span> votes
                        <div class="progress-bar">
                            <div class="progress" id="jeepProgress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="result-item">
                    <div class="result-symbol">
                        <i class="fas fa-eagle"></i>
                        <span>Eagle</span>
                    </div>
                    <div class="result-count">
                        <span id="eagleHbCount">0</span> votes
                        <div class="progress-bar">
                            <div class="progress" id="eagleHbProgress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                
                <h3>Deputy Head Boy</h3>
                <div class="result-item">
                    <div class="result-symbol">
                        <i class="fas fa-paw"></i>
                        <span>Wolf</span>
                    </div>
                    <div class="result-count">
                        <span id="wolfCount">0</span> votes
                        <div class="progress-bar">
                            <div class="progress" id="wolfProgress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="result-item">
                    <div class="result-symbol">
                        <i class="fas fa-horse"></i>
                        <span>Horse</span>
                    </div>
                    <div class="result-count">
                        <span id="horseCount">0</span> votes
                        <div class="progress-bar">
                            <div class="progress" id="horseProgress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                
                <h3>Head Girl</h3>
                <div class="result-item">
                    <div class="result-symbol">
                        <i class="fas fa-cookie"></i>
                        <span>Cookie</span>
                    </div>
                    <div class="result-count">
                        <span id="cookieCount">0</span> votes
                        <div class="progress-bar">
                            <div class="progress" id="cookieProgress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="result-item">
                    <div class="result-symbol">
                        <i class="fas fa-basketball-ball"></i>
                        <span>Basketball</span>
                    </div>
                    <div class="result-count">
                        <span id="basketballCount">0</span> votes
                        <div class="progress-bar">
                            <div class="progress" id="basketballProgress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                
                <h3>Deputy Head Girl</h3>
                <div class="result-item">
                    <div class="result-symbol">
                        <i class="fas fa-butterfly"></i>
                        <span>Butterfly</span>
                    </div>
                    <div class="result-count">
                        <span id="butterflyCount">0</span> votes
                        <div class="progress-bar">
                            <div class="progress" id="butterflyProgress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="result-item">
                    <div class="result-symbol">
                        <i class="fas fa-eagle"></i>
                        <span>Eagle</span>
                    </div>
                    <div class="result-count">
                        <span id="eagleDhgCount">0</span> votes
                        <div class="progress-bar">
                            <div class="progress" id="eagleDhgProgress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="admin-panel" id="adminPanel">
                    <h3>Administrator Panel</h3>
                    <p style="text-align: center; margin-bottom: 15px;">Manage election data</p>
                    
                    <div class="admin-buttons">
                        <button class="export-btn" id="exportBtn">
                            <i class="fas fa-download"></i> Export Results
                        </button>
                        <button class="reset-btn" id="resetBtn">
                            <i class="fas fa-trash"></i> Reset Election
                        </button>
                    </div>
                    
                    <h3 style="margin-top: 20px;">Student Voting Status</h3>
                    <div class="student-list" id="studentList">
                        <!-- Student list will be populated here -->
                    </div>
                </div>
            </div>
            
            <div class="view-toggle">
                <button id="voteViewBtn" class="active">Voting View</button>
                <button id="resultsViewBtn">Results View</button>
                <button id="adminViewBtn">Admin View</button>
            </div>
        </div>
        
        <footer>
            <p>Â© 2023 School Student Council Elections. All rights reserved.</p>
            <p>Each student can vote only once. Multiple students can vote from different devices.</p>
        </footer>
    </div>

    <script>
        // Enhanced database using localStorage with support for multiple categories
        function initializeDatabase() {
            if (!localStorage.getItem('votes')) {
                localStorage.setItem('votes', JSON.stringify({
                    // Head Boy
                    jeep: 0,
                    eagleHb: 0,
                    // Deputy Head Boy
                    wolf: 0,
                    horse: 0,
                    // Head Girl
                    cookie: 0,
                    basketball: 0,
                    // Deputy Head Girl
                    butterfly: 0,
                    eagleDhg: 0
                }));
            }
            
            if (!localStorage.getItem('votedStudents')) {
                localStorage.setItem('votedStudents', JSON.stringify([]));
            }
            
            if (!localStorage.getItem('studentList')) {
                localStorage.setItem('studentList', JSON.stringify([]));
            }
            
            if (!localStorage.getItem('electionSetup')) {
                localStorage.setItem('electionSetup', JSON.stringify(false));
            }
        }
        
        // Get elements
        const adminSetupSection = document.querySelector('.admin-setup-section');
        const loginSection = document.querySelector('.login-section');
        const votingSection = document.querySelector('.voting-section');
        const resultsSection = document.querySelector('.results');
        const adminPanel = document.getElementById('adminPanel');
        const studentList = document.getElementById('studentList');
        const voteUrl = document.getElementById('voteUrl');
        const adminSetupBtn = document.getElementById('adminSetupBtn');
        const loginBtn = document.getElementById('loginBtn');
        const castVoteBtn = document.getElementById('castVoteBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const exportBtn = document.getElementById('exportBtn');
        const resetBtn = document.getElementById('resetBtn');
        const adminError = document.getElementById('adminError');
        const adminSuccess = document.getElementById('adminSuccess');
        const loginError = document.getElementById('loginError');
        const voteError = document.getElementById('voteError');
        const voteSuccess = document.getElementById('voteSuccess');
        const symbols = document.querySelectorAll('.symbol');
        const voteViewBtn = document.getElementById('voteViewBtn');
        const resultsViewBtn = document.getElementById('resultsViewBtn');
        const adminViewBtn = document.getElementById('adminViewBtn');
        const adminPassword = document.getElementById('adminPassword');
        const studentIds = document.getElementById('studentIds');
        const studentId = document.getElementById('studentId');
        
        // State variables
        let currentStudentId = '';
        let selectedSymbols = {
            headBoy: null,
            deputyHeadBoy: null,
            headGirl: null,
            deputyHeadGirl: null
        };
        
        // Initialize the database
        initializeDatabase();
        
        // Display the voting URL
        voteUrl.textContent = window.location.href;
        
        // Check if election is already setup
        window.addEventListener('load', () => {
            const electionSetup = JSON.parse(localStorage.getItem('electionSetup'));
            const studentListData = JSON.parse(localStorage.getItem('studentList'));
            
            if (electionSetup && studentListData.length > 0) {
                adminSetupSection.style.display = 'none';
                loginSection.style.display = 'block';
            }
        });
        
        // Admin setup button event listener
        adminSetupBtn.addEventListener('click', () => {
            const password = adminPassword.value;
            const ids = studentIds.value.split('\n')
                .map(id => id.trim())
                .filter(id => id !== '');
            
            if (password !== 'admin123') {
                adminError.textContent = 'Invalid admin password';
                return;
            }
            
            if (ids.length === 0) {
                adminError.textContent = 'Please enter at least one student ID';
                return;
            }
            
            localStorage.setItem('studentList', JSON.stringify(ids));
            localStorage.setItem('electionSetup', JSON.stringify(true));
            
            adminError.textContent = '';
            adminSuccess.textContent = 'Election setup successfully! Students can now vote.';
            
            // Show login section after a delay
            setTimeout(() => {
                adminSetupSection.style.display = 'none';
                loginSection.style.display = 'block';
            }, 1500);
        });
        
        // Login button event listener
        loginBtn.addEventListener('click', () => {
            const studentIdValue = studentId.value.trim().toUpperCase();
            
            if (!studentIdValue) {
                loginError.textContent = 'Please enter your Student ID';
                return;
            }
            
            // Check if student ID is valid
            const studentListData = JSON.parse(localStorage.getItem('studentList'));
            if (studentListData.length === 0) {
                loginError.textContent = 'Election not setup yet. Please contact administrator.';
                return;
            }
            
            if (!studentListData.includes(studentIdValue)) {
                loginError.textContent = 'Invalid Student ID. Please check your ID and try again.';
                return;
            }
            
            // Check if student has already voted
            const votedStudents = JSON.parse(localStorage.getItem('votedStudents'));
            if (votedStudents.includes(studentIdValue)) {
                loginError.textContent = 'You have already voted. Each student can only vote once.';
                return;
            }
            
            currentStudentId = studentIdValue;
            loginError.textContent = '';
            loginSection.style.display = 'none';
            votingSection.style.display = 'block';
        });
        
        // Logout button event listener
        logoutBtn.addEventListener('click', () => {
            // Clear selection
            symbols.forEach(symbol => {
                symbol.classList.remove('selected');
            });
            selectedSymbols = {
                headBoy: null,
                deputyHeadBoy: null,
                headGirl: null,
                deputyHeadGirl: null
            };
            
            // Clear messages
            voteError.textContent = '';
            voteSuccess.textContent = '';
            
            // Enable voting buttons
            symbols.forEach(symbol => {
                symbol.style.pointerEvents = 'auto';
            });
            castVoteBtn.disabled = false;
            
            // Return to login
            votingSection.style.display = 'none';
            loginSection.style.display = 'block';
            studentId.value = '';
        });
        
        // Symbol selection
        symbols.forEach(symbol => {
            symbol.addEventListener('click', () => {
                const category = symbol.getAttribute('data-category');
                const symbolValue = symbol.getAttribute('data-symbol');
                
                // Remove selected class from all symbols in the same category
                document.querySelectorAll(`.symbol[data-category="${category}"]`).forEach(s => {
                    s.classList.remove('selected');
                });
                
                // Add selected class to clicked symbol
                symbol.classList.add('selected');
                
                // Set selected symbol
                selectedSymbols[category] = symbolValue;
                voteError.textContent = '';
            });
        });
        
        // Cast vote button
        castVoteBtn.addEventListener('click', () => {
            // Check if all categories have a selection
            for (const category in selectedSymbols) {
                if (selectedSymbols[category] === null) {
                    voteError.textContent = 'Please select one symbol from each category';
                    return;
                }
            }
            
            // Record the votes
            const votes = JSON.parse(localStorage.getItem('votes'));
            
            // Head Boy
            if (selectedSymbols.headBoy === 'jeep') votes.jeep += 1;
            if (selectedSymbols.headBoy === 'eagle') votes.eagleHb += 1;
            
            // Deputy Head Boy
            if (selectedSymbols.deputyHeadBoy === 'wolf') votes.wolf += 1;
            if (selectedSymbols.deputyHeadBoy === 'horse') votes.horse += 1;
            
            // Head Girl
            if (selectedSymbols.headGirl === 'cookie') votes.cookie += 1;
            if (selectedSymbols.headGirl === 'basketball') votes.basketball += 1;
            
            // Deputy Head Girl
            if (selectedSymbols.deputyHeadGirl === 'butterfly') votes.butterfly += 1;
            if (selectedSymbols.deputyHeadGirl === 'eagle') votes.eagleDhg += 1;
            
            localStorage.setItem('votes', JSON.stringify(votes));
            
            // Record that this student has voted
            const votedStudents = JSON.parse(localStorage.getItem('votedStudents'));
            votedStudents.push(currentStudentId);
            localStorage.setItem('votedStudents', JSON.stringify(votedStudents));
            
            // Show success message
            voteSuccess.textContent = 'Your vote has been cast successfully!';
            voteError.textContent = '';
            
            // Update results display
            updateResults();
            
            // Disable voting buttons
            symbols.forEach(symbol => {
                symbol.style.pointerEvents = 'none';
            });
            castVoteBtn.disabled = true;
        });
        
        // Export results button
        exportBtn.addEventListener('click', () => {
            const votes = JSON.parse(localStorage.getItem('votes'));
            const votedStudents = JSON.parse(localStorage.getItem('votedStudents'));
            const studentListData = JSON.parse(localStorage.getItem('studentList'));
            
            let csvContent = "Election Results\n\n";
            
            // Head Boy results
            csvContent += "Head Boy\n";
            csvContent += "Symbol,Votes,Percentage\n";
            const totalVotes = votedStudents.length;
            const hbTotal = votes.jeep + votes.eagleHb;
            csvContent += `Jeep,${votes.jeep},${hbTotal > 0 ? (votes.jeep/hbTotal*100).toFixed(1) : 0}%\n`;
            csvContent += `Eagle,${votes.eagleHb},${hbTotal > 0 ? (votes.eagleHb/hbTotal*100).toFixed(1) : 0}%\n\n`;
            
            // Deputy Head Boy results
            csvContent += "Deputy Head Boy\n";
            csvContent += "Symbol,Votes,Percentage\n";
            const dhbTotal = votes.wolf + votes.horse;
            csvContent += `Wolf,${votes.wolf},${dhbTotal > 0 ? (votes.wolf/dhbTotal*100).toFixed(1) : 0}%\n`;
            csvContent += `Horse,${votes.horse},${dhbTotal > 0 ? (votes.horse/dhbTotal*100).toFixed(1) : 0}%\n\n`;
            
            // Head Girl results
            csvContent += "Head Girl\n";
            csvContent += "Symbol,Votes,Percentage\n";
            const hgTotal = votes.cookie + votes.basketball;
            csvContent += `Cookie,${votes.cookie},${hgTotal > 0 ? (votes.cookie/hgTotal*100).toFixed(1) : 0}%\n`;
            csvContent += `Basketball,${votes.basketball},${hgTotal > 0 ? (votes.basketball/hgTotal*100).toFixed(1) : 0}%\n\n`;
            
            // Deputy Head Girl results
            csvContent += "Deputy Head Girl\n";
            csvContent += "Symbol,Votes,Percentage\n";
            const dhgTotal = votes.butterfly + votes.eagleDhg;
            csvContent += `Butterfly,${votes.butterfly},${dhgTotal > 0 ? (votes.butterfly/dhgTotal*100).toFixed(1) : 0}%\n`;
            csvContent += `Eagle,${votes.eagleDhg},${dhgTotal > 0 ? (votes.eagleDhg/dhgTotal*100).toFixed(1) : 0}%\n\n`;
            
            csvContent += `Total Votes,${totalVotes}\n\n`;
            csvContent += "Student Voting Status\n";
            csvContent += "Student ID,Status\n";
            
            studentListData.forEach(student => {
                csvContent += `${student},${votedStudents.includes(student) ? "Voted" : "Not Voted"}\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.setAttribute("href", url);
            link.setAttribute("download", "election_results.csv");
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });
        
        // Reset election button
        resetBtn.addEventListener('click', () => {
            if (confirm('Are you sure you want to reset the election? This will clear all votes and cannot be undone.')) {
                localStorage.removeItem('votes');
                localStorage.removeItem('votedStudents');
                localStorage.setItem('electionSetup', JSON.stringify(false));
                initializeDatabase();
                updateResults();
                updateStudentList();
                
                // Reset UI
                symbols.forEach(symbol => {
                    symbol.classList.remove('selected');
                    symbol.style.pointerEvents = 'auto';
                });
                voteError.textContent = '';
                voteSuccess.textContent = '';
                castVoteBtn.disabled = false;
                loginSection.style.display = 'none';
                votingSection.style.display = 'none';
                adminSetupSection.style.display = 'block';
                studentId.value = '';
                
                alert('Election has been reset. Please set up the election again.');
            }
        });
        
        // Update results display
        function updateResults() {
            const votes = JSON.parse(localStorage.getItem('votes'));
            
            // Update vote counts
            document.getElementById('jeepCount').textContent = votes.jeep;
            document.getElementById('eagleHbCount').textContent = votes.eagleHb;
            document.getElementById('wolfCount').textContent = votes.wolf;
            document.getElementById('horseCount').textContent = votes.horse;
            document.getElementById('cookieCount').textContent = votes.cookie;
            document.getElementById('basketballCount').textContent = votes.basketball;
            document.getElementById('butterflyCount').textContent = votes.butterfly;
            document.getElementById('eagleDhgCount').textContent = votes.eagleDhg;
            
            // Update progress bars
            const hbTotal = votes.jeep + votes.eagleHb;
            document.getElementById('jeepProgress').style.width = hbTotal > 0 ? `${votes.jeep/hbTotal*100}%` : '0%';
            document.getElementById('eagleHbProgress').style.width = hbTotal > 0 ? `${votes.eagleHb/hbTotal*100}%` : '0%';
            
            const dhbTotal = votes.wolf + votes.horse;
            document.getElementById('wolfProgress').style.width = dhbTotal > 0 ? `${votes.wolf/dhbTotal*100}%` : '0%';
            document.getElementById('horseProgress').style.width = dhbTotal > 0 ? `${votes.horse/dhbTotal*100}%` : '0%';
            
            const hgTotal = votes.cookie + votes.basketball;
            document.getElementById('cookieProgress').style.width = hgTotal > 0 ? `${votes.cookie/hgTotal*100}%` : '0%';
            document.getElementById('basketballProgress').style.width = hgTotal > 0 ? `${votes.basketball/hgTotal*100}%` : '0%';
            
            const dhgTotal = votes.butterfly + votes.eagleDhg;
            document.getElementById('butterflyProgress').style.width = dhgTotal > 0 ? `${votes.butterfly/dhgTotal*100}%` : '0%';
            document.getElementById('eagleDhgProgress').style.width = dhgTotal > 0 ? `${votes.eagleDhg/dhgTotal*100}%` : '0%';
        }
        
        // Update student list display
        function updateStudentList() {
            const studentListData = JSON.parse(localStorage.getItem('studentList'));
            const votedStudents = JSON.parse(localStorage.getItem('votedStudents'));
            
            studentList.innerHTML = '';
            
            studentListData.forEach(student => {
                const studentItem = document.createElement('div');
                studentItem.className = 'student-item';
                
                const status = votedStudents.includes(student) ? 
                    `<span class="voted">Voted</span>` : 
                    `<span class="not-voted">Not Voted</span>`;
                
                studentItem.innerHTML = `
                    <span>${student}</span>
                    ${status}
                `;
                
                studentList.appendChild(studentItem);
            });
        }
        
        // View toggle buttons
        voteViewBtn.addEventListener('click', () => {
            votingSection.style.display = 'block';
            resultsSection.style.display = 'none';
            adminPanel.style.display = 'none';
            voteViewBtn.classList.add('active');
            resultsViewBtn.classList.remove('active');
            adminViewBtn.classList.remove('active');
        });
        
        resultsViewBtn.addEventListener('click', () => {
            votingSection.style.display = 'none';
            resultsSection.style.display = 'block';
            adminPanel.style.display = 'none';
            voteViewBtn.classList.remove('active');
            resultsViewBtn.classList.add('active');
            adminViewBtn.classList.remove('active');
            updateResults();
        });
        
        adminViewBtn.addEventListener('click', () => {
            // Simple password protection for admin view
            const password = prompt('Enter admin password:');
            if (password === 'admin123') {
                votingSection.style.display = 'none';
                resultsSection.style.display = 'block';
                adminPanel.style.display = 'block';
                voteViewBtn.classList.remove('active');
                resultsViewBtn.classList.remove('active');
                adminViewBtn.classList.add('active');
                updateResults();
                updateStudentList();
            } else {
                alert('Invalid admin password');
            }
        });
        
        // Initial update of results
        updateResults();
    </script>
</body>
</html>
